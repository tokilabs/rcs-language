<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Rich Communication Language (RCL) - Formal Specification</title>
    <script src="https://www.w3.org/Tools/respec/respec-w3c" async class="remove"></script>
    <script class="remove">
      // ReSpec Configuration
      var respecConfig = {
        specStatus: "ED", // Editor's Draft
        shortName: "rcl-spec",
        edDraftURI: "https://github.com/tokilabs/rcs-language/blob/main/docs/index.html", // Link to the latest version
        github: "https://github.com/tokilabs/rcs-language",
        editors: [
          {
            name: "Saulo Vallory",
            url: "https://saulo.engineer",
          },
        ],
        wg: "RCL Working Group",
        wgURI: "https://github.com/tokilabs/rcs-language",
        localBiblio: {
            "RCL-PLAN": {
                title: "RCL Implementation Plan 2",
                href: "about:blank",
                authors: ["Saulo Vallory"],
                status: "Internal Document",
            }
        },
      };
    </script>
    <style>
      /* Styles for EBNF */
      pre.ebnf {
        background-color: #f7f7f7;
        border-left: 3px solid #005a9c;
        padding: 1em;
        white-space: pre-wrap;
        font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
      }
      pre.ebnf-comment {
        color: #6a737d;
        font-style: italic;
      }

    /* Styles from diagram page for diagram-specific EBNF display and signature */
    div.ebnf { /* Note: This is div.ebnf, ReSpec uses pre.ebnf */
      padding: 10px;
      background: #D1FFF0; /* Light green background for diagram EBNF blocks */
      /* width: 992px;  Potentially too wide, let's make it responsive */
      max-width: 100%;
      box-sizing: border-box;
      margin-top: 0.5em;
      margin-bottom: 0.5em;
    }
    div.ebnf div { /* For individual lines within diagram EBNF */
      padding-left: 13ch;
      text-indent: -13ch;
      font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; /* Match ReSpec's pre.ebnf font */
      font-size: inherit; /* Inherit font size */
    }
    div.ebnf code { /* The code tag within div.ebnf */
      font-family: inherit; /* Inherit from parent div.ebnf div */
      font-size: inherit;
    }
    .signature { /* For the "generated by" signature if we include it */
      color: #008055;
      font-size: 11px;
      text-align: right;
    }
    a:link.signature, a:visited.signature {
      color: #008055;
    }
    /* Selection styles can be nice to have consistently */
    ::-moz-selection {
      color: #F0FFFA;
      background: #000F0A;
    }
    ::selection {
      color: #F0FFFA;
      background: #000F0A;
    }
    /* Style for the images (diagrams) */
    img[src^="diagram/"], img[src^="docs/diagrams/diagram/"] {
        display: block;
        margin-top: 0.5em;
        margin-bottom: 0.5em;
        max-width: 100%;
        height: auto;
    }
    </style>
    <link rel="stylesheet" href="diagrams/diagrams.css">
  </head>
  <body>
    <section id="abstract">
      This document provides the formal specification for the Rich Communication Language (RCL) using an Extended Backus-Naur Form (EBNF)-like notation. This specification is derived from the Langium grammar files and the design decisions outlined in the [[RCL-PLAN]]. Its primary purpose is to define the valid syntax of an RCL document. Semantic rules, error recovery, and the precise behavior of the underlying expression language are outside the scope of this EBNF specification.
    </section>

    <section id="sotd">
      <!-- Status of This Document section -->
      <p>
        This document is an unofficial draft and is not a W3C Standard. It is intended for discussion and implementation guidance.
      </p>
    </section>

    <section id="conformance">
      <h2>Conformance</h2>
      <p>[[!RFC2119]]</p>
      <p>TBD</p>
    </section>
    
    <section>
        <h2>Introduction</h2>
        <p>This document provides the formal specification for the Rich Communication Language (RCL) using an Extended Backus-Naur Form (EBNF)-like notation. This specification is derived from the Langium grammar files and the design decisions outlined in the `rcl-implementation-plan-2.md`.</p>
        <p>Its primary purpose is to define the valid syntax of an RCL document. Semantic rules, error recovery, and the precise behavior of the underlying expression language are outside the scope of this EBNF specification and are covered by other parts of the language design (e.g., validators, interpreter/transpiler logic).</p>

        <section>
            <h3>Notation Conventions</h3>
            <p>The grammar is specified using EBNF-like notation:</p>
            <ul>
                <li><code><a>RuleName</a> ::= Definition</code> : Defines a rule.</li>
                <li><code>'literal'</code> : Represents a literal string or keyword (e.g., <code>'Agent'</code>, <code>':'</code>).</li>
                <li><code>TERMINAL_NAME</code> : Represents a terminal symbol, a basic token recognized by the lexer (e.g., <a href="#IDENTIFIER_def">IDENTIFIER</a>, <a href="#STRING_def">STRING</a>).</li>
                <li><code><a>RuleName</a></code> : (When on the right-hand side) Represents a non-terminal symbol, a reference to another rule (e.g., <a>AgentDefinition</a>, <a>SimpleValue</a>).</li>
                <li><code>A | B</code> : Represents an alternative (A or B).</li>
                <li><code>(A B)</code> : Represents a sequence of A followed by B.</li>
                <li><code>A?</code> : Represents zero or one occurrence of A (optional).</li>
                <li><code>A*</code> : Represents zero or more occurrences of A.</li>
                <li><code>A+</code> : Represents one or more occurrences of A.</li>
                <li><code>// comment</code> : Explanatory comments.</li>
            </ul>
            <div class="note">
                <p><strong>Note on AST Mapping:</strong> While this EBNF does not explicitly use <code>property_name: RuleCall</code> syntax, it is implied that in a corresponding Abstract Syntax Tree (AST), sequenced elements or named terminals/non-terminals would map to named properties of the AST node for the rule. For example, <code><a>Parameter</a> ::= <a href="#IDENTIFIER_def">IDENTIFIER</a> ':' <a>SimpleValue</a></code> would likely result in an AST node for `Parameter` with properties corresponding to the captured <a href="#IDENTIFIER_def">IDENTIFIER</a> and <a>SimpleValue</a>.</p>
            </div>
        </section>
    </section>

    <section>
        <h2>Lexical Specification (Terminals)</h2>
        <p>These are the fundamental building blocks (tokens) of the RCL, recognized by the lexer.</p>
        
        <section>
            <h3>Indentation Terminals (Synthetic)</h3>
            <p>These tokens are not directly present as characters in the input text but are generated by the lexer based on changes in leading whitespace.</p>
            <pre class="ebnf"><dfn id="INDENT_def">INDENT</dfn> ::= /* Marks a significant increase in indentation level. */
<dfn id="DEDENT_def">DEDENT</dfn> ::= /* Marks a significant decrease in indentation level, closing one or more blocks. */</pre>
        </section>

        <section>
            <h3>Hidden Terminals (Ignored by the parser)</h3>
            <p>These tokens are recognized but do not form part of the structural syntax passed to the parser, except for their role in separating other tokens.</p>
            <pre class="ebnf">WS ::= /[\t ]+/         // Whitespace (one or more spaces or tabs), does not include newlines.
NL ::= /[\r\n]+/        // Newlines (one or more).
SL_COMMENT ::= /#.*/    // Single-line comments (from '#' to end of line).</pre>
            <div class="note">
                <p><strong>Note on Whitespace within Rules:</strong> The `WS` hidden terminal allows for optional spaces and tabs between any adjacent non-hidden terminals or literal keywords within a parser rule sequence. Newlines (`NL`) primarily act as statement terminators and are crucial for the lexer's indentation analysis. This EBNF does not explicitly notate whitespace between all elements, as this is implied.</p>
            </div>
        </section>
        
        <section>
            <h3>Common Terminals</h3>
            <pre class="ebnf"><dfn id="IDENTIFIER_def">IDENTIFIER</dfn> ::= /[A-Z]([A-Za-z0-9-]|(\s(?=[A-Z0-9])))*/ // Defined in Section 4.1.</pre>
            <figure class="railroad-diagram">
              <img src="diagrams/diagram/IDENTIFIER.svg" alt="Railroad diagram for IDENTIFIER">
              <figcaption>Railroad diagram for <code>IDENTIFIER</code>.</figcaption>
            </figure>
            <div class="note informative diagram-ebnf">
              <p>EBNF for diagram generation (from <a href="diagrams/index.html#IDENTIFIER">diagrams/index.html#IDENTIFIER</a>):</p>
              <div class="ebnf"><code>
                    <div><a href="diagrams/index.html#IDENTIFIER" title="IDENTIFIER">IDENTIFIER</a></div>
                    <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::= <a href="diagrams/index.html#IDENTIFIER_START_CHAR" title="IDENTIFIER_START_CHAR">IDENTIFIER_START_CHAR</a><a href="diagrams/index.html#IDENTIFIER_CONT_UNIT" title="IDENTIFIER_CONT_UNIT">IDENTIFIER_CONT_UNIT</a>*</div>
              </code></div>
            </div>
            <pre class="ebnf"><dfn id="ATOM_def">ATOM</dfn> ::= /:([_a-zA-Z][\w_]*|\"[^\"\\]*\")/ // e.g., :symbol or :"quoted symbol".</pre>
            <figure class="railroad-diagram">
              <img src="diagrams/diagram/ATOM.svg" alt="Railroad diagram for ATOM">
              <figcaption>Railroad diagram for <code>ATOM</code>.</figcaption>
            </figure>
            <div class="note informative diagram-ebnf">
              <p>EBNF for diagram generation (from <a href="diagrams/index.html#ATOM">diagrams/index.html#ATOM</a>):</p>
              <div class="ebnf"><code>
                    <div><a href="diagrams/index.html#ATOM" title="ATOM">ATOM</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::= ':' ( <a href="diagrams/index.html#ATOM_UNQUOTED_PART" title="ATOM_UNQUOTED_PART">ATOM_UNQUOTED_PART</a> | <a href="diagrams/index.html#ATOM_QUOTED_PART" title="ATOM_QUOTED_PART">ATOM_QUOTED_PART</a> )</div>
              </code></div>
            </div>
            <pre class="ebnf"><dfn id="STRING_def">STRING</dfn> ::= /\"(\\.|\[^\"\\])*\"/           // Double-quoted strings with standard escape sequences.</pre>
            <figure class="railroad-diagram">
              <img src="diagrams/diagram/STRING.svg" alt="Railroad diagram for STRING">
              <figcaption>Railroad diagram for <code>STRING</code>.</figcaption>
            </figure>
            <div class="note informative diagram-ebnf">
              <p>EBNF for diagram generation (from <a href="diagrams/index.html#STRING">diagrams/index.html#STRING</a>):</p>
              <div class="ebnf"><code>
                    <div><a href="diagrams/index.html#STRING" title="STRING">STRING</a>&nbsp;&nbsp;&nbsp;::= '\"' <a href="diagrams/index.html#STRING_CONTENT_CHAR" title="STRING_CONTENT_CHAR">STRING_CONTENT_CHAR</a>* '\"'</div>
              </code></div>
            </div>
            <pre class="ebnf"><dfn id="NUMBER_def">NUMBER</dfn> ::= /[0-9]+(\.[0-9]+)?([eE][-+]?[0-9]+)?/ // Integer or floating-point numbers.</pre>
            <figure class="railroad-diagram">
              <img src="diagrams/diagram/NUMBER.svg" alt="Railroad diagram for NUMBER">
              <figcaption>Railroad diagram for <code>NUMBER</code>.</figcaption>
            </figure>
            <div class="note informative diagram-ebnf">
              <p>EBNF for diagram generation (from <a href="diagrams/index.html#NUMBER">diagrams/index.html#NUMBER</a>):</p>
              <div class="ebnf"><code>
                    <div><a href="diagrams/index.html#NUMBER" title="NUMBER">NUMBER</a>&nbsp;&nbsp;&nbsp;::= <a href="diagrams/index.html#INTEGER_PART" title="INTEGER_PART">INTEGER_PART</a><a href="diagrams/index.html#DECIMAL_PART" title="DECIMAL_PART">DECIMAL_PART</a>? <a href="diagrams/index.html#EXPONENT_PART" title="EXPONENT_PART">EXPONENT_PART</a>?</div>
              </code></div>
            </div>
            <pre class="ebnf"><dfn id="TIME_LITERAL_def">TIME_LITERAL</dfn> ::= /~T\\[[0-9]{2}:[0-9]{2}\\]/      // Format: ~T[HH:MM].</pre>
            <figure class="railroad-diagram">
              <img src="diagrams/diagram/TIME_LITERAL.svg" alt="Railroad diagram for TIME_LITERAL">
              <figcaption>Railroad diagram for <code>TIME_LITERAL</code>.</figcaption>
            </figure>
            <div class="note informative diagram-ebnf">
              <p>EBNF for diagram generation (from <a href="diagrams/index.html#TIME_LITERAL">diagrams/index.html#TIME_LITERAL</a>):</p>
              <div class="ebnf"><code>
                    <div><a href="diagrams/index.html#TIME_LITERAL" title="TIME_LITERAL">TIME_LITERAL</a></div>
                    <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::= "'~T['" <a href="diagrams/index.html#DIGIT" title="DIGIT">DIGIT</a><a href="diagrams/index.html#DIGIT" title="DIGIT">DIGIT</a> ':' <a href="diagrams/index.html#DIGIT" title="DIGIT">DIGIT</a><a href="diagrams/index.html#DIGIT" title="DIGIT">DIGIT</a> "']'"</div>
              </code></div>
            </div>
            <pre class="ebnf"><dfn id="ISO_DURATION_LITERAL_def">ISO_DURATION_LITERAL</dfn> ::= /(P(\d+Y)?(\d+M)?(\d+W)?(\d+D)?(T(\d+H)?(\d+M)?(\d+(\.\d+)?S)?)?)|([0-9]+(\.[0-9]+)?s)/ // ISO 8601 duration or simple seconds (e.g., "3.5s").</pre>
        </section>
        
        <section>
            <h3>Expression Terminals</h3>
            <p>The content within these expressions is treated as raw text by the RCL parser.</p>
            <pre class="ebnf"><dfn id="SINGLE_LINE_EXPRESSION_def">SINGLE_LINE_EXPRESSION</dfn> ::= /\$([a-z]*>)\s*[^\r\n]*/     // e.g., $js> console.log('hello'), $> someValue.</pre>
            <figure class="railroad-diagram">
              <img src="diagrams/diagram/SINGLE_LINE_EXPRESSION.svg" alt="Railroad diagram for SINGLE_LINE_EXPRESSION">
              <figcaption>Railroad diagram for <code>SINGLE_LINE_EXPRESSION</code>.</figcaption>
            </figure>
            <div class="note informative diagram-ebnf">
              <p>EBNF for diagram generation (from <a href="diagrams/index.html#SINGLE_LINE_EXPRESSION">diagrams/index.html#SINGLE_LINE_EXPRESSION</a>):</p>
              <div class="ebnf"><code>
                    <div><a href="diagrams/index.html#SINGLE_LINE_EXPRESSION" title="SINGLE_LINE_EXPRESSION">SINGLE_LINE_EXPRESSION</a></div>
                    <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::= <a href="diagrams/index.html#SINGLE_LINE_EXPRESSION_MARKER" title="SINGLE_LINE_EXPRESSION_MARKER">SINGLE_LINE_EXPRESSION_MARKER</a><a href="diagrams/index.html#WS" title="WS">WS</a>* <a href="diagrams/index.html#SINGLE_LINE_EXPRESSION_CONTENT_CHAR" title="SINGLE_LINE_EXPRESSION_CONTENT_CHAR">SINGLE_LINE_EXPRESSION_CONTENT_CHAR</a>*</div>
              </code></div>
            </div>
            <pre class="ebnf"><dfn id="MULTI_LINE_EXPRESSION_START_def">MULTI_LINE_EXPRESSION_START</dfn> ::= /\$([a-z]*>>>)/          // e.g., $ts>>>, $>>>.</pre>
            <figure class="railroad-diagram">
              <img src="diagrams/diagram/MULTI_LINE_EXPRESSION_START.svg" alt="Railroad diagram for MULTI_LINE_EXPRESSION_START">
              <figcaption>Railroad diagram for <code>MULTI_LINE_EXPRESSION_START</code>.</figcaption>
            </figure>
            <div class="note informative diagram-ebnf">
              <p>EBNF for diagram generation (from <a href="diagrams/index.html#MULTI_LINE_EXPRESSION_START">diagrams/index.html#MULTI_LINE_EXPRESSION_START</a>):</p>
              <div class="ebnf"><code>
                    <div><a href="diagrams/index.html#MULTI_LINE_EXPRESSION_START" title="MULTI_LINE_EXPRESSION_START">MULTI_LINE_EXPRESSION_START</a></div>
                    <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::= '$' <a href="diagrams/index.html#EXPRESSION_LANG_TAG" title="EXPRESSION_LANG_TAG">EXPRESSION_LANG_TAG</a> '&gt;' '&gt;' '&gt;'</div>
              </code></div>
            </div>
            <pre class="ebnf"><dfn id="MULTI_LINE_EXPRESSION_CONTENT_def">MULTI_LINE_EXPRESSION_CONTENT</dfn> ::= /[^]*/                 // Raw content of a multi-line block, terminated by a DEDENT.</pre>
        </section>
        
        <section>
            <h3>Multi-line String Terminals</h3>
            <pre class="ebnf"><dfn id="MULTILINE_STRING_CLEAN_def">MULTILINE_STRING_CLEAN</dfn> ::= /\|\s*$/        // Marker: | (at end of line, possibly with trailing whitespace).</pre>
            <figure class="railroad-diagram">
              <img src="diagrams/diagram/MULTILINE_STRING_CLEAN.svg" alt="Railroad diagram for MULTILINE_STRING_CLEAN">
              <figcaption>Railroad diagram for <code>MULTILINE_STRING_CLEAN</code>.</figcaption>
            </figure>
            <div class="note informative diagram-ebnf">
              <p>EBNF for diagram generation (from <a href="diagrams/index.html#MULTILINE_STRING_CLEAN">diagrams/index.html#MULTILINE_STRING_CLEAN</a>):</p>
              <div class="ebnf"><code>
                    <div><a href="diagrams/index.html#MULTILINE_STRING_CLEAN" title="MULTILINE_STRING_CLEAN">MULTILINE_STRING_CLEAN</a></div>
                    <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::= '|' <a href="diagrams/index.html#WS" title="WS">WS</a>* <a href="diagrams/index.html#EOL" title="EOL">EOL</a></div>
              </code></div>
            </div>
            <pre class="ebnf"><dfn id="MULTILINE_STRING_TRIM_def">MULTILINE_STRING_TRIM</dfn> ::= /\|-\s*$/         // Marker: |- (at end of line, possibly with trailing whitespace).</pre>
            <figure class="railroad-diagram">
              <img src="diagrams/diagram/MULTILINE_STRING_TRIM.svg" alt="Railroad diagram for MULTILINE_STRING_TRIM">
              <figcaption>Railroad diagram for <code>MULTILINE_STRING_TRIM</code>.</figcaption>
            </figure>
            <div class="note informative diagram-ebnf">
              <p>EBNF for diagram generation (from <a href="diagrams/index.html#MULTILINE_STRING_TRIM">diagrams/index.html#MULTILINE_STRING_TRIM</a>):</p>
              <div class="ebnf"><code>
                    <div><a href="diagrams/index.html#MULTILINE_STRING_TRIM" title="MULTILINE_STRING_TRIM">MULTILINE_STRING_TRIM</a></div>
                    <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::= '|' '-' <a href="diagrams/index.html#WS" title="WS">WS</a>* <a href="diagrams/index.html#EOL" title="EOL">EOL</a></div>
              </code></div>
            </div>
            <pre class="ebnf"><dfn id="MULTILINE_STRING_PRESERVE_def">MULTILINE_STRING_PRESERVE</dfn> ::= /\+\|\s*$/    // Marker: +| (at end of line, possibly with trailing whitespace).</pre>
            <figure class="railroad-diagram">
              <img src="diagrams/diagram/MULTILINE_STRING_PRESERVE.svg" alt="Railroad diagram for MULTILINE_STRING_PRESERVE">
              <figcaption>Railroad diagram for <code>MULTILINE_STRING_PRESERVE</code>.</figcaption>
            </figure>
            <div class="note informative diagram-ebnf">
              <p>EBNF for diagram generation (from <a href="diagrams/index.html#MULTILINE_STRING_PRESERVE">diagrams/index.html#MULTILINE_STRING_PRESERVE</a>):</p>
              <div class="ebnf"><code>
                    <div><a href="diagrams/index.html#MULTILINE_STRING_PRESERVE" title="MULTILINE_STRING_PRESERVE">MULTILINE_STRING_PRESERVE</a></div>
                    <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::= '+' '|' <a href="diagrams/index.html#WS" title="WS">WS</a>* <a href="diagrams/index.html#EOL" title="EOL">EOL</a></div>
              </code></div>
            </div>
            <pre class="ebnf"><dfn id="MULTILINE_STRING_PRESERVE_ALL_def">MULTILINE_STRING_PRESERVE_ALL</dfn> ::= /\+\|\+\s*$/ // Marker: +|+ (at end of line, possibly with trailing whitespace).</pre>
            <figure class="railroad-diagram">
              <img src="diagrams/diagram/MULTILINE_STRING_PRESERVE_ALL.svg" alt="Railroad diagram for MULTILINE_STRING_PRESERVE_ALL">
              <figcaption>Railroad diagram for <code>MULTILINE_STRING_PRESERVE_ALL</code>.</figcaption>
            </figure>
            <div class="note informative diagram-ebnf">
              <p>EBNF for diagram generation (from <a href="diagrams/index.html#MULTILINE_STRING_PRESERVE_ALL">diagrams/index.html#MULTILINE_STRING_PRESERVE_ALL</a>):</p>
              <div class="ebnf"><code>
                    <div><a href="diagrams/index.html#MULTILINE_STRING_PRESERVE_ALL" title="MULTILINE_STRING_PRESERVE_ALL">MULTILINE_STRING_PRESERVE_ALL</a></div>
                    <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::= '+' '|' '+' <a href="diagrams/index.html#WS" title="WS">WS</a>* <a href="diagrams/index.html#EOL" title="EOL">EOL</a></div>
              </code></div>
            </div>
            <pre class="ebnf"><dfn id="STRING_CONTENT_def">STRING_CONTENT</dfn> ::= /[^]*/                   // Raw content of a multi-line string, terminated by a DEDENT.</pre>
        </section>
        
        <section>
            <h3>Type Conversion Terminals</h3>
            <pre class="ebnf">// Literals '<', '>', and '|' are used directly in the TypeConversion rule.
<dfn id="TYPE_NAME_def">TYPE_NAME</dfn> ::= /[a-zA-Z]+/                   // e.g., phone, email, date (used within TypeConversion rule).</pre>
            <figure class="railroad-diagram">
              <img src="diagrams/diagram/TYPE_NAME.svg" alt="Railroad diagram for TYPE_NAME">
              <figcaption>Railroad diagram for <code>TYPE_NAME</code>.</figcaption>
            </figure>
            <div class="note informative diagram-ebnf">
              <p>EBNF for diagram generation (from <a href="diagrams/index.html#TYPE_NAME">diagrams/index.html#TYPE_NAME</a>):</p>
              <div class="ebnf"><code>
                    <div><a href="diagrams/index.html#TYPE_NAME" title="TYPE_NAME">TYPE_NAME</a></div>
                    <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::= <a href="diagrams/index.html#LETTER" title="LETTER">LETTER</a>+</div>
              </code></div>
            </div>
        </section>
    </section>

    <section>
        <h2>Syntactic Specification (Parser Rules)</h2>
        <section>
            <h3>Core &amp; Common Rules</h3>
            <pre class="ebnf"><dfn>QualifiedName</dfn> ::= <a href="#IDENTIFIER_def">IDENTIFIER</a> ('.' <a href="#IDENTIFIER_def">IDENTIFIER</a>)*</pre>
            <figure class="railroad-diagram">
              <img src="diagrams/diagram/qualifiedName.svg" alt="Railroad diagram for QualifiedName">
              <figcaption>Railroad diagram for <code>QualifiedName</code>.</figcaption>
            </figure>
            <div class="note informative diagram-ebnf">
              <p>EBNF for diagram generation (from <a href="diagrams/index.html#qualifiedName">diagrams/index.html#qualifiedName</a>):</p>
              <div class="ebnf"><code>
                    <div><a href="diagrams/index.html#qualifiedName" title="qualifiedName">qualifiedName</a></div>
                    <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::= <a href="diagrams/index.html#IDENTIFIER" title="IDENTIFIER">IDENTIFIER</a> ( '.' <a href="diagrams/index.html#IDENTIFIER" title="IDENTIFIER">IDENTIFIER</a> )*</div>
              </code></div>
            </div>
            <pre class="ebnf"><dfn>BooleanLiteral</dfn> ::= 'true' | 'false'</pre>
            <figure class="railroad-diagram">
              <img src="diagrams/diagram/booleanLiteral.svg" alt="Railroad diagram for BooleanLiteral">
              <figcaption>Railroad diagram for <code>BooleanLiteral</code>.</figcaption>
            </figure>
            <div class="note informative diagram-ebnf">
              <p>EBNF for diagram generation (from <a href="diagrams/index.html#booleanLiteral">diagrams/index.html#booleanLiteral</a>):</p>
              <div class="ebnf"><code>
                    <div><a href="diagrams/index.html#booleanLiteral" title="booleanLiteral">booleanLiteral</a></div>
                    <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::= 'true'</div>
                    <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| 'false'</div>
              </code></div>
            </div>
            <pre class="ebnf"><dfn>SimpleValue</dfn> ::= <a href="#STRING_def">STRING</a> | <a href="#NUMBER_def">NUMBER</a> | <a>BooleanLiteral</a> | <a href="#ATOM_def">ATOM</a> | <a href="#TIME_LITERAL_def">TIME_LITERAL</a> | <a href="#ISO_DURATION_LITERAL_def">ISO_DURATION_LITERAL</a></pre>
            <figure class="railroad-diagram">
              <img src="diagrams/diagram/simpleValue.svg" alt="Railroad diagram for SimpleValue">
              <figcaption>Railroad diagram for <code>SimpleValue</code>.</figcaption>
            </figure>
            <div class="note informative diagram-ebnf">
              <p>EBNF for diagram generation (from <a href="diagrams/index.html#simpleValue">diagrams/index.html#simpleValue</a>):</p>
              <div class="ebnf"><code>
                    <div><a href="diagrams/index.html#simpleValue" title="simpleValue">simpleValue</a></div>
                    <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::= <a href="diagrams/index.html#STRING" title="STRING">STRING</a></div>
                    <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a href="diagrams/index.html#NUMBER" title="NUMBER">NUMBER</a></div>
                    <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a href="diagrams/index.html#booleanLiteral" title="booleanLiteral">booleanLiteral</a></div>
                    <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a href="diagrams/index.html#ATOM" title="ATOM">ATOM</a></div>
                    <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a href="diagrams/index.html#TIME_LITERAL" title="TIME_LITERAL">TIME_LITERAL</a></div>
                    <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a href="diagrams/index.html#ISO_DURATION_LITERAL" title="ISO_DURATION_LITERAL">ISO_DURATION_LITERAL</a></div>
              </code></div>
            </div>
            <pre class="ebnf"><dfn>Parameter</dfn> ::= <a href="#IDENTIFIER_def">IDENTIFIER</a> ':' <a>SimpleValue</a></pre>
            <figure class="railroad-diagram">
              <img src="diagrams/diagram/parameter.svg" alt="Railroad diagram for Parameter">
              <figcaption>Railroad diagram for <code>Parameter</code>.</figcaption>
            </figure>
            <div class="note informative diagram-ebnf">
              <p>EBNF for diagram generation (from <a href="diagrams/index.html#parameter">diagrams/index.html#parameter</a>):</p>
              <div class="ebnf"><code>
                    <div><a href="diagrams/index.html#parameter" title="parameter">parameter</a></div>
                    <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::= <a href="diagrams/index.html#IDENTIFIER" title="IDENTIFIER">IDENTIFIER</a> ':' <a href="diagrams/index.html#simpleValue" title="simpleValue">simpleValue</a></div>
              </code></div>
            </div>
            <pre class="ebnf"><dfn>PropertyAssignment</dfn> ::= <a href="#IDENTIFIER_def">IDENTIFIER</a> ':' <a>Value</a></pre>
            <figure class="railroad-diagram">
              <img src="diagrams/diagram/propertyAssignment.svg" alt="Railroad diagram for PropertyAssignment">
              <figcaption>Railroad diagram for <code>PropertyAssignment</code>.</figcaption>
            </figure>
            <div class="note informative diagram-ebnf">
              <p>EBNF for diagram generation (from <a href="diagrams/index.html#propertyAssignment">diagrams/index.html#propertyAssignment</a>):</p>
              <div class="ebnf"><code>
                    <div><a href="diagrams/index.html#propertyAssignment" title="propertyAssignment">propertyAssignment</a></div>
                    <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::= <a href="diagrams/index.html#IDENTIFIER" title="IDENTIFIER">IDENTIFIER</a> ':' <a href="diagrams/index.html#value" title="value">value</a></div>
              </code></div>
            </div>
            <pre class="ebnf"><dfn>ExplicitMap</dfn> ::= '%' '{' (<a>PropertyAssignment</a>)* '}'</pre>
            <figure class="railroad-diagram">
              <img src="diagrams/diagram/explicitMap.svg" alt="Railroad diagram for ExplicitMap">
              <figcaption>Railroad diagram for <code>ExplicitMap</code>.</figcaption>
            </figure>
            <div class="note informative diagram-ebnf">
              <p>EBNF for diagram generation (from <a href="diagrams/index.html#explicitMap">diagrams/index.html#explicitMap</a>):</p>
              <div class="ebnf"><code>
                    <div><a href="diagrams/index.html#explicitMap" title="explicitMap">explicitMap</a></div>
                    <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::= '%' '{' <a href="diagrams/index.html#propertyAssignment" title="propertyAssignment">propertyAssignment</a>* '}'</div>
              </code></div>
            </div>
            <pre class="ebnf"><dfn>InlineParameterList</dfn> ::= <a>Parameter</a> (',' <a>Parameter</a>)*</pre>
            <figure class="railroad-diagram">
              <img src="diagrams/diagram/inlineParameterList.svg" alt="Railroad diagram for InlineParameterList">
              <figcaption>Railroad diagram for <code>InlineParameterList</code>.</figcaption>
            </figure>
            <div class="note informative diagram-ebnf">
              <p>EBNF for diagram generation (from <a href="diagrams/index.html#inlineParameterList">diagrams/index.html#inlineParameterList</a>):</p>
              <div class="ebnf"><code>
                    <div><a href="diagrams/index.html#inlineParameterList" title="inlineParameterList">inlineParameterList</a></div>
                    <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::= <a href="diagrams/index.html#parameter" title="parameter">parameter</a> ( ',' <a href="diagrams/index.html#parameter" title="parameter">parameter</a> )*</div>
              </code></div>
            </div>
            <pre class="ebnf"><dfn>Value</dfn> ::= <a>SimpleValue</a> | <a>ExplicitMap</a> | <a>InlineParameterList</a> | <a>Ref</a></pre>
            <figure class="railroad-diagram">
              <img src="diagrams/diagram/value.svg" alt="Railroad diagram for Value">
              <figcaption>Railroad diagram for <code>Value</code>.</figcaption>
            </figure>
            <div class="note informative diagram-ebnf">
              <p>EBNF for diagram generation (from <a href="diagrams/index.html#value">diagrams/index.html#value</a>):</p>
              <div class="ebnf"><code>
                    <div><a href="diagrams/index.html#value" title="value">value</a>&nbsp;&nbsp;&nbsp;&nbsp;::= <a href="diagrams/index.html#simpleValue" title="simpleValue">simpleValue</a></div>
                    <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a href="diagrams/index.html#explicitMap" title="explicitMap">explicitMap</a></div>
                    <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a href="diagrams/index.html#inlineParameterList" title="inlineParameterList">inlineParameterList</a></div>
                    <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a href="diagrams/index.html#ref" title="ref">ref</a></div>
              </code></div>
            </div>
            <pre class="ebnf"><dfn>Ref</dfn> ::= <a href="#IDENTIFIER_def">IDENTIFIER</a> // This IDENTIFIER references another named entity.</pre>
            <figure class="railroad-diagram">
              <img src="diagrams/diagram/ref.svg" alt="Railroad diagram for Ref">
              <figcaption>Railroad diagram for <code>Ref</code>.</figcaption>
            </figure>
            <div class="note informative diagram-ebnf">
              <p>EBNF for diagram generation (from <a href="diagrams/index.html#ref">diagrams/index.html#ref</a>):</p>
              <div class="ebnf"><code>
                    <div><a href="diagrams/index.html#ref" title="ref">ref</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::= <a href="diagrams/index.html#IDENTIFIER" title="IDENTIFIER">IDENTIFIER</a></div>
              </code></div>
            </div>
        </section>
        
        <section>
            <h3>Expression Rules</h3>
             <pre class="ebnf"><dfn>SingleLineExpression</dfn> ::= <a href="#SINGLE_LINE_EXPRESSION_def">SINGLE_LINE_EXPRESSION</a></pre>
             <figure class="railroad-diagram">
               <img src="diagrams/diagram/singleLineExpression.svg" alt="Railroad diagram for SingleLineExpression">
               <figcaption>Railroad diagram for <code>SingleLineExpression</code>.</figcaption>
             </figure>
             <div class="note informative diagram-ebnf">
               <p>EBNF for diagram generation (from <a href="diagrams/index.html#singleLineExpression">diagrams/index.html#singleLineExpression</a>):</p>
               <div class="ebnf"><code>
                     <div><a href="diagrams/index.html#singleLineExpression" title="singleLineExpression">singleLineExpression</a></div>
                     <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::= <a href="diagrams/index.html#SINGLE_LINE_EXPRESSION" title="SINGLE_LINE_EXPRESSION">SINGLE_LINE_EXPRESSION</a></div>
               </code></div>
             </div>
             <pre class="ebnf"><dfn>MultiLineExpression</dfn> ::= <a href="#MULTI_LINE_EXPRESSION_START_def">MULTI_LINE_EXPRESSION_START</a> <a href="#INDENT_def">INDENT</a> <a href="#MULTI_LINE_EXPRESSION_CONTENT_def">MULTI_LINE_EXPRESSION_CONTENT</a> <a href="#DEDENT_def">DEDENT</a></pre>
             <figure class="railroad-diagram">
               <img src="diagrams/diagram/multiLineExpression.svg" alt="Railroad diagram for MultiLineExpression">
               <figcaption>Railroad diagram for <code>MultiLineExpression</code>.</figcaption>
             </figure>
             <div class="note informative diagram-ebnf">
               <p>EBNF for diagram generation (from <a href="diagrams/index.html#multiLineExpression">diagrams/index.html#multiLineExpression</a>):</p>
               <div class="ebnf"><code>
                     <div><a href="diagrams/index.html#multiLineExpression" title="multiLineExpression">multiLineExpression</a></div>
                     <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::= <a href="diagrams/index.html#MULTI_LINE_EXPRESSION_START" title="MULTI_LINE_EXPRESSION_START">MULTI_LINE_EXPRESSION_START</a> '' <a href="diagrams/index.html#MULTI_LINE_EXPRESSION_CONTENT" title="MULTI_LINE_EXPRESSION_CONTENT">MULTI_LINE_EXPRESSION_CONTENT</a> ''</div>
               </code></div>
             </div>
             <pre class="ebnf"><dfn>Expression</dfn> ::= <a>SingleLineExpression</a> | <a>MultiLineExpression</a></pre>
             <figure class="railroad-diagram">
               <img src="diagrams/diagram/expression.svg" alt="Railroad diagram for Expression">
               <figcaption>Railroad diagram for <code>Expression</code>.</figcaption>
             </figure>
             <div class="note informative diagram-ebnf">
               <p>EBNF for diagram generation (from <a href="diagrams/index.html#expression">diagrams/index.html#expression</a>):</p>
               <div class="ebnf"><code>
                     <div><a href="diagrams/index.html#expression" title="expression">expression</a></div>
                     <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::= <a href="diagrams/index.html#singleLineExpression" title="singleLineExpression">singleLineExpression</a></div>
                     <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a href="diagrams/index.html#multiLineExpression" title="multiLineExpression">multiLineExpression</a></div>
               </code></div>
             </div>
             <pre class="ebnf"><dfn>ExpressionValue</dfn> ::= <a>Expression</a> | <a>SimpleValue</a> // A value can be a direct expression or a simple literal.</pre>
             <figure class="railroad-diagram">
               <img src="diagrams/diagram/expressionValue.svg" alt="Railroad diagram for ExpressionValue">
               <figcaption>Railroad diagram for <code>ExpressionValue</code>.</figcaption>
             </figure>
             <div class="note informative diagram-ebnf">
               <p>EBNF for diagram generation (from <a href="diagrams/index.html#expressionValue">diagrams/index.html#expressionValue</a>):</p>
               <div class="ebnf"><code>
                     <div><a href="diagrams/index.html#expressionValue" title="expressionValue">expressionValue</a></div>
                     <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::= <a href="diagrams/index.html#expression" title="expression">expression</a></div>
                     <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a href="diagrams/index.html#simpleValue" title="simpleValue">simpleValue</a></div>
               </code></div>
             </div>
        </section>
        
        <section>
            <h3>Multi-line String Rules</h3>
            <pre class="ebnf"><dfn>MultiLineString</dfn> ::= ( <a href="#MULTILINE_STRING_CLEAN_def">MULTILINE_STRING_CLEAN</a> | <a href="#MULTILINE_STRING_TRIM_def">MULTILINE_STRING_TRIM</a> | <a href="#MULTILINE_STRING_PRESERVE_def">MULTILINE_STRING_PRESERVE</a> | <a href="#MULTILINE_STRING_PRESERVE_ALL_def">MULTILINE_STRING_PRESERVE_ALL</a> ) <a href="#INDENT_def">INDENT</a> <a href="#STRING_CONTENT_def">STRING_CONTENT</a> <a href="#DEDENT_def">DEDENT</a></pre>
            <figure class="railroad-diagram">
              <img src="diagrams/diagram/multiLineString.svg" alt="Railroad diagram for MultiLineString">
              <figcaption>Railroad diagram for <code>MultiLineString</code>.</figcaption>
            </figure>
            <div class="note informative diagram-ebnf">
              <p>EBNF for diagram generation (from <a href="diagrams/index.html#multiLineString">diagrams/index.html#multiLineString</a>):</p>
              <div class="ebnf"><code>
                    <div><a href="diagrams/index.html#multiLineString" title="multiLineString">multiLineString</a></div>
                    <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::= ( <a href="diagrams/index.html#MULTILINE_STRING_CLEAN" title="MULTILINE_STRING_CLEAN">MULTILINE_STRING_CLEAN</a> | <a href="diagrams/index.html#MULTILINE_STRING_TRIM" title="MULTILINE_STRING_TRIM">MULTILINE_STRING_TRIM</a> | <a href="diagrams/index.html#MULTILINE_STRING_PRESERVE" title="MULTILINE_STRING_PRESERVE">MULTILINE_STRING_PRESERVE</a> | <a href="diagrams/index.html#MULTILINE_STRING_PRESERVE_ALL" title="MULTILINE_STRING_PRESERVE_ALL">MULTILINE_STRING_PRESERVE_ALL</a> ) '' <a href="diagrams/index.html#STRING_CONTENT" title="STRING_CONTENT">STRING_CONTENT</a> ''</div>
              </code></div>
            </div>
            <pre class="ebnf"><dfn>EnhancedSimpleValue</dfn> ::= <a href="#STRING_def">STRING</a> | <a href="#NUMBER_def">NUMBER</a> | <a>BooleanLiteral</a> | <a href="#ATOM_def">ATOM</a> | <a href="#TIME_LITERAL_def">TIME_LITERAL</a> | <a href="#ISO_DURATION_LITERAL_def">ISO_DURATION_LITERAL</a> | <a>MultiLineString</a></pre>
            <figure class="railroad-diagram">
              <img src="diagrams/diagram/enhancedSimpleValue.svg" alt="Railroad diagram for EnhancedSimpleValue">
              <figcaption>Railroad diagram for <code>EnhancedSimpleValue</code>.</figcaption>
            </figure>
            <div class="note informative diagram-ebnf">
              <p>EBNF for diagram generation (from <a href="diagrams/index.html#enhancedSimpleValue">diagrams/index.html#enhancedSimpleValue</a>):</p>
              <div class="ebnf"><code>
                    <div><a href="diagrams/index.html#enhancedSimpleValue" title="enhancedSimpleValue">enhancedSimpleValue</a></div>
                    <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::= <a href="diagrams/index.html#STRING" title="STRING">STRING</a></div>
                    <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a href="diagrams/index.html#NUMBER" title="NUMBER">NUMBER</a></div>
                    <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a href="diagrams/index.html#booleanLiteral" title="booleanLiteral">booleanLiteral</a></div>
                    <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a href="diagrams/index.html#ATOM" title="ATOM">ATOM</a></div>
                    <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a href="diagrams/index.html#TIME_LITERAL" title="TIME_LITERAL">TIME_LITERAL</a></div>
                    <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a href="diagrams/index.html#ISO_DURATION_LITERAL" title="ISO_DURATION_LITERAL">ISO_DURATION_LITERAL</a></div>
                    <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a href="diagrams/index.html#multiLineString" title="multiLineString">multiLineString</a></div>
              </code></div>
            </div>
        </section>

        <section>
            <h3>Type Conversion Rules</h3>
            <pre class="ebnf"><dfn>TypeConversionValue</dfn> ::= <a href="#STRING_def">STRING</a> | <a href="#NUMBER_def">NUMBER</a> | <a href="#ATOM_def">ATOM</a> | <a href="#IDENTIFIER_def">IDENTIFIER</a> // The raw value part inside a type conversion tag.</pre>
            <figure class="railroad-diagram">
              <img src="diagrams/diagram/typeConversionValue.svg" alt="Railroad diagram for TypeConversionValue">
              <figcaption>Railroad diagram for <code>TypeConversionValue</code>.</figcaption>
            </figure>
            <div class="note informative diagram-ebnf">
              <p>EBNF for diagram generation (from <a href="diagrams/index.html#typeConversionValue">diagrams/index.html#typeConversionValue</a>):</p>
              <div class="ebnf"><code>
                    <div><a href="diagrams/index.html#typeConversionValue" title="typeConversionValue">typeConversionValue</a></div>
                    <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::= <a href="diagrams/index.html#STRING" title="STRING">STRING</a></div>
                    <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a href="diagrams/index.html#NUMBER" title="NUMBER">NUMBER</a></div>
                    <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a href="diagrams/index.html#ATOM" title="ATOM">ATOM</a></div>
                    <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a href="diagrams/index.html#IDENTIFIER" title="IDENTIFIER">IDENTIFIER</a></div>
              </code></div>
            </div>
            <pre class="ebnf"><dfn>TypeConversion</dfn> ::= '&lt;' <a href="#TYPE_NAME_def">TYPE_NAME</a> <a>TypeConversionValue</a> ('|' <a href="#STRING_def">STRING</a>)? '>' // e.g., &lt;email "user@example.com"&gt;</pre>
            <figure class="railroad-diagram">
              <img src="diagrams/diagram/typeConversion.svg" alt="Railroad diagram for TypeConversion">
              <figcaption>Railroad diagram for <code>TypeConversion</code>.</figcaption>
            </figure>
            <div class="note informative diagram-ebnf">
              <p>EBNF for diagram generation (from <a href="diagrams/index.html#typeConversion">diagrams/index.html#typeConversion</a>):</p>
              <div class="ebnf"><code>
                    <div><a href="diagrams/index.html#typeConversion" title="typeConversion">typeConversion</a></div>
                    <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::= '&lt;' <a href="diagrams/index.html#TYPE_NAME" title="TYPE_NAME">TYPE_NAME</a><a href="diagrams/index.html#typeConversionValue" title="typeConversionValue">typeConversionValue</a> ( '|' <a href="diagrams/index.html#STRING" title="STRING">STRING</a> )? '&gt;'</div>
              </code></div>
            </div>
            <pre class="ebnf"><dfn>TypedValue</dfn> ::= <a>TypeConversion</a> | <a>EnhancedSimpleValue</a> // A value can be a type conversion or an enhanced simple value.</pre>
            <figure class="railroad-diagram">
              <img src="diagrams/diagram/typedValue.svg" alt="Railroad diagram for TypedValue">
              <figcaption>Railroad diagram for <code>TypedValue</code>.</figcaption>
            </figure>
            <div class="note informative diagram-ebnf">
              <p>EBNF for diagram generation (from <a href="diagrams/index.html#typedValue">diagrams/index.html#typedValue</a>):</p>
              <div class="ebnf"><code>
                    <div><a href="diagrams/index.html#typedValue" title="typedValue">typedValue</a></div>
                    <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::= <a href="diagrams/index.html#typeConversion" title="typeConversion">typeConversion</a></div>
                    <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a href="diagrams/index.html#enhancedSimpleValue" title="enhancedSimpleValue">enhancedSimpleValue</a></div>
              </code></div>
            </div>
        </section>
        
        <section>
            <h3>Main RCL Structure</h3>
            <pre class="ebnf"><dfn>RclFile</dfn> ::= (<a>ImportStatement</a>)* <a>AgentDefinition</a>
<dfn>ImportStatement</dfn> ::= 'import' <a href="#STRING_def">STRING</a> ('as' <a href="#IDENTIFIER_def">IDENTIFIER</a>)? ';'
<dfn>AgentDefinition</dfn> ::= 'Agent' <a>QualifiedName</a> <a href="#INDENT_def">INDENT</a> ('displayName' ':' <a href="#STRING_def">STRING</a>) ('brandName' ':' <a href="#STRING_def">STRING</a>)? (<a>ConfigSection</a>)? (<a>DefaultsSection</a>)? (<a>EnhancedFlowSection</a>)+ <a>MessagesSection</a> <a href="#DEDENT_def">DEDENT</a>
<dfn>DefaultsSection</dfn> ::= 'Defaults' <a href="#INDENT_def">INDENT</a> ( <a>DefaultProperty</a> )* <a href="#DEDENT_def">DEDENT</a>
<dfn>DefaultProperty</dfn> ::= ('fallback_message' ':' <a>EnhancedSimpleValue</a>) | ('messageTrafficType' ':' <a href="#ATOM_def">ATOM</a>) | ('ttl' ':' <a href="#ISO_DURATION_LITERAL_def">ISO_DURATION_LITERAL</a>) | ('postbackData' ':' <a>Expression</a>) | ('expressions' <a href="#INDENT_def">INDENT</a> ('language' ':' <a href="#ATOM_def">ATOM</a>) <a href="#DEDENT_def">DEDENT</a>) | ('timeZone' ':' (<a href="#STRING_def">STRING</a> | <a>Expression</a>) )
<dfn>MessagesSection</dfn> ::= 'Messages' <a href="#INDENT_def">INDENT</a> (<a>AgentMessage</a> | <a>MessageShortcut</a>)+ <a href="#DEDENT_def">DEDENT</a></pre>
        </section>

        <section>
            <h3>Flow System Rules</h3>
             <div class="note">
                <p><strong>Note on Precedence:</strong> In <a>EnhancedFlowRule</a>, the arrow sequence <a>FlowOperandOrExpression</a> ('->' <a>FlowOperandOrExpression</a>)+ is parsed as a complete unit. The <a>EnhancedWithClause</a>, if present, applies to this entire preceding arrow sequence.</p>
            </div>
            <pre class="ebnf"><dfn>EnhancedFlowSection</dfn> ::= 'flow' <a href="#IDENTIFIER_def">IDENTIFIER</a> <a href="#INDENT_def">INDENT</a> (<a>EnhancedFlowRule</a>)* <a href="#DEDENT_def">DEDENT</a>
<dfn>EnhancedFlowRule</dfn> ::= <a>FlowOperandOrExpression</a> ('->' <a>FlowOperandOrExpression</a>)+ (<a>EnhancedWithClause</a>)?
<dfn>FlowOperand</dfn> ::= <a href="#ATOM_def">ATOM</a> | <a href="#IDENTIFIER_def">IDENTIFIER</a> | <a href="#STRING_def">STRING</a> // Literal operands in a flow.
<dfn>FlowActionText</dfn> ::= 'text' <a>EnhancedSimpleValue</a> // A direct text output action in a flow.
<dfn>FlowOperandOrExpression</dfn> ::= <a>FlowOperand</a> | <a>FlowActionText</a> | <a>Expression</a> | ('ref' <a href="#IDENTIFIER_def">IDENTIFIER</a>)
<dfn>EnhancedWithClause</dfn> ::= 'with' <a>EnhancedParameter</a> (',' <a>EnhancedParameter</a>)*
<dfn>EnhancedParameter</dfn> ::= <a href="#IDENTIFIER_def">IDENTIFIER</a> ':' <a>ExpressionValue</a> // Parameter name and its value.</pre>
        </section>
        
        <section>
            <h3>Agent Configuration Rules</h3>
            <p>Properties within this section map to `rcsBusinessMessagingAgent` in `agent-config.schema.json`.</p>
            <pre class="ebnf"><dfn>ConfigSection</dfn> ::= 'Config' <a href="#INDENT_def">INDENT</a> ( <a>ConfigProperty</a> )* <a href="#DEDENT_def">DEDENT</a>
<dfn>ConfigProperty</dfn> ::= ('description' ':' <a>EnhancedSimpleValue</a>) | ('logoUri' ':' <a href="#STRING_def">STRING</a>) | ('heroUri' ':' <a href="#STRING_def">STRING</a>) | <a>PhoneNumberProperty</a> | <a>EmailProperty</a> | <a>WebsiteProperty</a> | <a>PrivacyProperty</a> | <a>TermsConditionsProperty</a> | ('color' ':' <a href="#STRING_def">STRING</a>) | <a>BillingConfigProperty</a> | ('agentUseCase' ':' <a href="#ATOM_def">ATOM</a>)? | ('hostingRegion' ':' <a href="#ATOM_def">ATOM</a>)?
<dfn>PhoneNumberProperty</dfn> ::= 'phoneNumberEntry' <a href="#INDENT_def">INDENT</a> ('number' ':' <a>TypedValue</a>) ('label' ':' <a>EnhancedSimpleValue</a>)? <a href="#DEDENT_def">DEDENT</a>
<dfn>EmailProperty</dfn> ::= 'emailEntry' <a href="#INDENT_def">INDENT</a> ('address' ':' <a>TypedValue</a>) ('label' ':' <a>EnhancedSimpleValue</a>)? <a href="#DEDENT_def">DEDENT</a>
<dfn>WebsiteProperty</dfn> ::= 'websiteEntry' <a href="#INDENT_def">INDENT</a> ('url' ':' <a>TypedValue</a>) ('label' ':' <a>EnhancedSimpleValue</a>)? <a href="#DEDENT_def">DEDENT</a>
<dfn>PrivacyProperty</dfn> ::= 'privacy' <a href="#INDENT_def">INDENT</a> ('url' ':' <a>TypedValue</a>) ('label' ':' <a>EnhancedSimpleValue</a>)? <a href="#DEDENT_def">DEDENT</a>
<dfn>TermsConditionsProperty</dfn> ::= 'termsConditions' <a href="#INDENT_def">INDENT</a> ('url' ':' <a>TypedValue</a>) ('label' ':' <a>EnhancedSimpleValue</a>)? <a href="#DEDENT_def">DEDENT</a>
<dfn>BillingConfigProperty</dfn> ::= 'billingConfig' <a href="#INDENT_def">INDENT</a> ('billingCategory' ':' <a href="#ATOM_def">ATOM</a>)? <a href="#DEDENT_def">DEDENT</a></pre>
        </section>
        
        <section>
            <h3>Agent Message Rules</h3>
             <pre class="ebnf"><dfn>AgentMessage</dfn> ::= 'agentMessage' (<a href="#IDENTIFIER_def">IDENTIFIER</a>)? <a href="#INDENT_def">INDENT</a> ('messageTrafficType' ':' <a href="#ATOM_def">ATOM</a>)? ( ('expireTime' ':' <a href="#STRING_def">STRING</a>) | ('ttl' ':' <a href="#ISO_DURATION_LITERAL_def">ISO_DURATION_LITERAL</a>) )? <a>ContentMessage</a> <a href="#DEDENT_def">DEDENT</a>
<dfn>ContentMessage</dfn> ::= 'contentMessage' <a href="#INDENT_def">INDENT</a> ( ('text' ':' (<a>EnhancedSimpleValue</a> | <a>ExpressionValue</a>) ) | ('fileName' ':' <a href="#STRING_def">STRING</a>) | ('uploadedRbmFile' <a>UploadedRbmFile</a>) | ('richCard' <a>RichCard</a>) | ('contentInfo' <a>ContentInfo</a>) ) (<a>Suggestion</a>)* <a href="#DEDENT_def">DEDENT</a>
<dfn>Suggestion</dfn> ::= 'suggestion' <a href="#INDENT_def">INDENT</a> ( ('reply' <a>SuggestedReply</a>) | ('action' <a>SuggestedAction</a>) ) <a href="#DEDENT_def">DEDENT</a>
<dfn>SuggestedReply</dfn> ::= <a>InlineParameterList</a>
<dfn>SuggestedAction</dfn> ::= (<a>InlineParameterList</a)? <a href="#INDENT_def">INDENT</a> ( <a>DialAction</a> | <a>ViewLocationAction</a> | <a>CreateCalendarEventAction</a> | <a>OpenUrlAction</a> | <a>ShareLocationAction</a> | <a>ComposeAction</a> ) <a href="#DEDENT_def">DEDENT</a>
<dfn>DialAction</dfn> ::= 'dialAction' <a href="#INDENT_def">INDENT</a> ('phoneNumber' ':' <a>TypedValue</a>) <a href="#DEDENT_def">DEDENT</a>
<dfn>LatLongObject</dfn> ::= <a>InlineParameterList</a>
<dfn>ViewLocationAction</dfn> ::= 'viewLocationAction' <a href="#INDENT_def">INDENT</a> ('label' ':' <a>EnhancedSimpleValue</a>)? ( ('latLong' <a>LatLongObject</a>) | ('query' ':' <a>EnhancedSimpleValue</a>) ) <a href="#DEDENT_def">DEDENT</a>
<dfn>CreateCalendarEventAction</dfn> ::= 'createCalendarEventAction' <a href="#INDENT_def">INDENT</a> <a>InlineParameterList</a> <a href="#DEDENT_def">DEDENT</a>
<dfn>ShareLocationAction</dfn> ::= 'shareLocationAction'
<dfn>OpenUrlAction</dfn> ::= 'openUrlAction' <a href="#INDENT_def">INDENT</a> ('url' ':' <a>TypedValue</a>) <a href="#DEDENT_def">DEDENT</a>
<dfn>ComposeAction</dfn> ::= 'composeAction' <a href="#INDENT_def">INDENT</a> ( <a>ComposeTextMessage</a> | <a>ComposeRecordingMessage</a> ) <a href="#DEDENT_def">DEDENT</a>
<dfn>ComposeTextMessage</dfn> ::= 'composeTextMessage' <a href="#INDENT_def">INDENT</a> <a>InlineParameterList</a> <a href="#DEDENT_def">DEDENT</a>
<dfn>ComposeRecordingMessage</dfn> ::= 'composeRecordingMessage' <a href="#INDENT_def">INDENT</a> <a>InlineParameterList</a> <a href="#DEDENT_def">DEDENT</a>
<dfn>UploadedRbmFile</dfn> ::= <a>ExplicitMap</a> | <a>InlineParameterList</a>
<dfn>ContentInfo</dfn> ::= <a>ExplicitMap</a> | <a>InlineParameterList</a>
<dfn>RichCard</dfn> ::= 'richCard' <a href="#INDENT_def">INDENT</a> ( <a>StandaloneCard</a> | <a>CarouselCard</a> ) <a href="#DEDENT_def">DEDENT</a>
<dfn>StandaloneCard</dfn> ::= 'standaloneCard' <a href="#INDENT_def">INDENT</a> ('cardOrientation' ':' <a href="#ATOM_def">ATOM</a>)? ('thumbnailImageAlignment' ':' <a href="#ATOM_def">ATOM</a>)? <a>CardContent</a> <a href="#DEDENT_def">DEDENT</a>
<dfn>CarouselCard</dfn> ::= 'carouselCard' <a href="#INDENT_def">INDENT</a> ('cardWidth' ':' <a href="#ATOM_def">ATOM</a>)? <a>CardContent</a> <a>CardContent</a>+ <a href="#DEDENT_def">DEDENT</a>
<dfn>CardContent</dfn> ::= 'cardContent' <a href="#INDENT_def">INDENT</a> ('title' ':' <a>EnhancedSimpleValue</a>)? ('description' ':' <a>EnhancedSimpleValue</a>)? (<a>Media</a>)? (<a>CardSuggestion</a>)* <a href="#DEDENT_def">DEDENT</a>
<dfn>CardSuggestion</dfn> ::= 'suggestion' <a href="#INDENT_def">INDENT</a> ( ('reply' <a>SuggestedReply</a>) | ('action' <a>SuggestedAction</a>) ) <a href="#DEDENT_def">DEDENT</a>
<dfn>Media</dfn> ::= 'media' <a href="#INDENT_def">INDENT</a> ('height' ':' <a href="#ATOM_def">ATOM</a>)? ( ('file' <a>UploadedRbmFile</a>) | ('contentInfo' <a>ContentInfo</a>) ) <a href="#DEDENT_def">DEDENT</a></pre>
        </section>
        
        <section>
            <h3>RCS Spec Shortcut Rules</h3>
            <p>These rules describe syntactic sugar. Their transformation into full structures is a separate semantic process.</p>
            <pre class="ebnf"><dfn>MessageShortcut</dfn> ::= <a>TextShortcut</a> | <a>FileShortcut</a> | <a>RichCardShortcut</a>
<dfn>TextShortcut</dfn> ::= 'text' (<a>EnhancedSimpleValue</a> | <a>ExpressionValue</a>) ( <a href="#INDENT_def">INDENT</a> (<a>SuggestionShortcut</a>)* <a href="#DEDENT_def">DEDENT</a> )?
<dfn>FileShortcut</dfn> ::= 'uploadedRbmFile' <a href="#STRING_def">STRING</a> (<a href="#STRING_def">STRING</a>)? ( <a href="#INDENT_def">INDENT</a> (<a>SuggestionShortcut</a>)* <a href="#DEDENT_def">DEDENT</a> )?
<dfn>RichCardShortcut</dfn> ::= 'richCard' <a>EnhancedSimpleValue</a> (<a>EnhancedSimpleValue</a>)? ( <a href="#INDENT_def">INDENT</a> (<a>Media</a>)? (<a>SuggestionShortcut</a>)* <a href="#DEDENT_def">DEDENT</a> )?
<dfn>SuggestionShortcut</dfn> ::= <a>ReplyShortcut</a> | <a>DialShortcut</a> | <a>OpenUrlShortcut</a> | <a>ShareLocationShortcut</a> | <a>CreateCalendarEventShortcut</a> | <a>ViewLocationShortcut</a>
<dfn>ReplyShortcut</dfn> ::= 'reply' <a>EnhancedSimpleValue</a> (<a href="#STRING_def">STRING</a>)?
<dfn>DialShortcut</dfn> ::= 'dial' <a>EnhancedSimpleValue</a> <a>TypedValue</a>
<dfn>OpenUrlShortcut</dfn> ::= 'openUrl' <a>EnhancedSimpleValue</a> <a>TypedValue</a> (<a>EnhancedSimpleValue</a>)? ( (':BROWSER' | ':WEBVIEW') ( (':FULL' | ':HALF' | ':TALL') )? )?
<dfn>ShareLocationShortcut</dfn> ::= 'shareLocation' <a>EnhancedSimpleValue</a>
<dfn>CreateCalendarEventShortcut</dfn> ::= 'createCalendarEvent' <a>EnhancedSimpleValue</a> <a href="#INDENT_def">INDENT</a> 'event' <a>EnhancedSimpleValue</a> <a>TypedValue</a> <a>TypedValue</a> <a>EnhancedSimpleValue</a> <a href="#DEDENT_def">DEDENT</a>
<dfn>ViewLocationShortcut</dfn> ::= 'viewLocation' <a>EnhancedSimpleValue</a> <a href="#INDENT_def">INDENT</a> ( (('latLng' <a href="#NUMBER_def">NUMBER</a> <a href="#NUMBER_def">NUMBER</a>)) | (('query' ':' <a>EnhancedSimpleValue</a>)) ) ('label' ':' <a>EnhancedSimpleValue</a>)? <a href="#DEDENT_def">DEDENT</a></pre>
        </section>
    </section>

    <section>
        <h2>Identifier Rules</h2>
        <section>
            <h3>Valid Identifier Definition (Lexical Rule: <a href="#IDENTIFIER_def">IDENTIFIER</a>)</h3>
            <p>Identifiers are names used for variables, functions, sections, and other named entities within RCL.</p>
            <ul>
                <li><strong>Start</strong>: An identifier MUST start with an uppercase letter (A-Z).</li>
                <li><strong>Subsequent Characters</strong>: Subsequent characters MAY be uppercase letters (A-Z), lowercase letters (a-z), numbers (0-9), or hyphens (`-`).</li>
                <li><strong>Spaces</strong>: Spaces are allowed within an identifier, but ONLY if the character immediately following the space is an uppercase letter or a number (e.g., <code>User ID</code>, <code>Order Number 123</code>).</li>
                <li><strong>Hyphens</strong>: Hyphens are allowed but MUST NOT be preceded or followed by a space. They MUST be part of a continuous sequence of non-space characters (e.g., <code>Calculate-Total-Amount</code>).</li>
                <li><strong>Case Sensitivity</strong>: Identifiers are case-sensitive.</li>
                <li><strong>Reserved Names</strong>: System-level primary keywords (like `Agent`, `Config`, `Defaults`, `Messages`, `flow` when used to start a section) MUST NOT be used as IDENTIFIERs if it creates ambiguity with the grammar structure. However, these words MAY appear within a valid IDENTIFIER (e.g., `My Config Settings`, `Default Flow Start`). Validation rules SHOULD ensure clarity.</li>
            </ul>
        </section>
        <section class="informative">
            <h3>Examples of Valid Identifiers</h3>
            <pre>MyVariable
CustomerName
ProcessOrder
User ID
Order Number 123
Calculate-Total-Amount</pre>
        </section>
    </section>
    
    <section>
        <h2>Type System</h2>
        <section>
            <h3>Built-in Type Conversions (Syntax Rule: <a>TypeConversion</a>)</h3>
            <p>RCL supports explicit type conversion syntax for certain values. The rule is defined as: <code><a>TypeConversion</a> ::= '&lt;' <a href="#TYPE_NAME_def">TYPE_NAME</a> <a>TypeConversionValue</a> ('|' <a href="#STRING_def">STRING</a>)? '>'</code>.</p>
            <p>Examples:</p>
            <ul>
                <li><code>&lt;email "user@example.com"&gt;</code></li>
                <li><code>&lt;phone "+1234567890"&gt;</code></li>
                <li><code>&lt;time "14:30" | "Europe/Berlin"&gt;</code></li>
                <li><code>&lt;date "2024-07-26"&gt;</code></li>
            </ul>
            <p>The <a href="#TYPE_NAME_def">TYPE_NAME</a> terminal captures the type keyword (e.g., "email", "phone"). The semantic validity of the <a href="#TYPE_NAME_def">TYPE_NAME</a> and the <a>TypeConversionValue</a> against the specified type, including timezone handling, is subject to semantic validation handled by language services, not purely by this EBNF.</p>
        </section>
        <section class="informative">
            <h3>Supported Types (Semantic Interpretation)</h3>
            <p>The following type names are recognized by the RCL system for validation and potential transformation:</p>
            <ul>
                <li>`email`: Validates email format.</li>
                <li>`phone`/`msisdn`: Validates and potentially formats phone numbers.</li>
                <li>`url`: Validates URL format.</li>
                <li>`time`: Parses time, with optional timezone support.</li>
                <li>`datetime`/`date`: Parses dates.</li>
                <li>`zipcode`/`zip`: Validates postal codes.</li>
            </ul>
        </section>
    </section>

    <section id="indentation-layout">
        <h2>Indentation and Layout</h2>
        <p>RCL is indentation-sensitive. The structure of blocks is defined by <a href="#INDENT_def">INDENT</a> and <a href="#DEDENT_def">DEDENT</a> tokens, which are generated by the lexer based on changes in leading whitespace.</p>
        <section>
            <h3>Indentation Significance</h3>
            <p>The lexer is responsible for tracking the current indentation level. It emits <a href="#INDENT_def">INDENT</a> when indentation increases significantly relative to the parent block and <a href="#DEDENT_def">DEDENT</a> when indentation decreases. Multiple <a href="#DEDENT_def">DEDENT</a> tokens may be emitted if un-indenting multiple levels. The precise algorithm for <a href="#INDENT_def">INDENT</a>/<a href="#DEDENT_def">DEDENT</a> generation (e.g., how many spaces constitute a new level, consistent use of spaces vs. tabs) is a lexer implementation detail. Consistent use of spaces (e.g., 2 or 4 spaces per level) is strongly recommended for readability and predictable lexer behavior.</p>
        </section>
        <section>
            <h3>Lexer Responsibility</h3>
            <ul>
                <li>Tracking the current indentation level.</li>
                <li>Emitting <a href="#INDENT_def">INDENT</a> when indentation increases significantly relative to the parent block.</li>
                <li>Emitting <a href="#DEDENT_def">DEDENT</a> when indentation decreases, potentially emitting multiple <a href="#DEDENT_def">DEDENT</a> tokens if un-indenting multiple levels.</li>
                <li>Handling newlines (<code>NL</code>) and whitespace (<code>WS</code>) between tokens.</li>
                <li>The precise algorithm for <a href="#INDENT_def">INDENT</a>/<a href="#DEDENT_def">DEDENT</a> generation (e.g., how many spaces constitute a new level, consistent use of spaces vs. tabs) is a lexer implementation detail. Consistent use of spaces (e.g., 2 or 4 spaces per level) is strongly recommended for readability and predictable lexer behavior.</li>
            </ul>
        </section>
        <section>
            <h3>Blank Lines</h3>
            <p>Blank lines (containing only <code>WS</code> and/or <code>NL</code> tokens) are typically ignored in terms of structural parsing, except where they might terminate a preceding construct if the language defines such a rule (not explicitly the case in RCL general block structure, which relies on <a href="#DEDENT_def">DEDENT</a>).</p>
        </section>
    </section>

    <section id="expression-system">
        <h2>Expression System</h2>
        <p>RCL allows embedding expressions in specified parts of the language. These expressions are defined by the lexical tokens <a href="#SINGLE_LINE_EXPRESSION_def">SINGLE_LINE_EXPRESSION</a>, <a href="#MULTI_LINE_EXPRESSION_START_def">MULTI_LINE_EXPRESSION_START</a>, and <a href="#MULTI_LINE_EXPRESSION_CONTENT_def">MULTI_LINE_EXPRESSION_CONTENT</a>.</p>
        <section>
            <h3>Expression Syntax</h3>
            <p>RCL supports both single-line and multi-line expressions:</p>
            <ul>
                <li><strong>Single-line</strong>: Starts with <code>$</code> followed by an optional language identifier (e.g., <code>js</code>, <code>ts</code>) and <code>&gt;</code>, then the expression code on the same line. Examples: <code>$js&gt; context.user.name</code>, <code>$&gt; someDefaultExpression()</code>.</li>
                <li><strong>Multi-line</strong>: Starts with <code>$</code> followed by an optional language identifier and <code>&gt;&gt;&gt;</code>, then an indented block of code.
                    <pre class="rcl"><code>$ts&gt;&gt;&gt;
    let x = 10;
    return x * 2;</code></pre>
                </li>
            </ul>
        </section>
        <section>
            <h3>Content Handling</h3>
            <p>The RCL parser treats the content of these expressions as opaque strings (captured by <a href="#SINGLE_LINE_EXPRESSION_def">SINGLE_LINE_EXPRESSION</a> or <a href="#MULTI_LINE_EXPRESSION_CONTENT_def">MULTI_LINE_EXPRESSION_CONTENT</a>). The actual parsing, validation, and execution of the expression code (e.g., as JavaScript/TypeScript) are responsibilities of a separate expression evaluation engine or transpilation step, not the RCL grammar itself.</p>
        </section>
        <section>
            <h3>Available Context (Semantic)</h3>
            <p>Semantically, when these expressions are evaluated, they are expected to have access to:</p>
            <ul>
                <li>A <code>context</code> variable (providing information about the current flow, state, user data, etc.).</li>
                <li>A set of <code>RclUtils</code> global utility functions.</li>
                <li>Standard features of the target expression language (e.g., ECMAScript 6 for JavaScript).</li>
            </ul>
        </section>
    </section>

    <section id="multi-line-string-system">
        <h2>Multi-line String System</h2>
        <p>RCL supports several syntaxes for multi-line string literals, primarily differing in whitespace handling. These are defined by lexical tokens such as <a href="#MULTILINE_STRING_CLEAN_def">MULTILINE_STRING_CLEAN</a>, <a href="#MULTILINE_STRING_TRIM_def">MULTILINE_STRING_TRIM</a>, <a href="#MULTILINE_STRING_PRESERVE_def">MULTILINE_STRING_PRESERVE</a>, and <a href="#MULTILINE_STRING_PRESERVE_ALL_def">MULTILINE_STRING_PRESERVE_ALL</a>.</p>
        <section>
            <h3>String Variants and Markers</h3>
            <ul>
                <li><code>|</code> (<a href="#MULTILINE_STRING_CLEAN_def">MULTILINE_STRING_CLEAN</a>): Typically trims common leading whitespace from each line (based on the indentation of the least indented line within the block or the marker's own column) and results in a single newline at the end of the entire string.</li>
                <li><code>|-</code> (<a href="#MULTILINE_STRING_TRIM_def">MULTILINE_STRING_TRIM</a>): Similar to <code>|</code>, but ensures no trailing newline at the end of the entire string.</li>
                <li><code>+|</code> (<a href="#MULTILINE_STRING_PRESERVE_def">MULTILINE_STRING_PRESERVE</a>): Preserves leading whitespace relative to the marker's column and ensures a single newline at the end.</li>
                <li><code>+|+</code> (<a href="#MULTILINE_STRING_PRESERVE_ALL_def">MULTILINE_STRING_PRESERVE_ALL</a>): Preserves all whitespace, including leading and trailing newlines exactly as they appear in the indented block.</li>
            </ul>
        </section>
        <section>
            <h3>Content Handling</h3>
            <p>The content of multi-line strings (captured by <a href="#STRING_CONTENT_def">STRING_CONTENT</a>) is determined by the indented block following the marker, up to the corresponding <a href="#DEDENT_def">DEDENT</a>. The lexer and parser work together to capture this content, with whitespace processing rules applied semantically based on the chosen marker during a later transformation or interpretation phase.</p>
        </section>
    </section>
    
    <section class="appendix">
        <h2>Further Considerations and Out-of-Scope Items for EBNF</h2>
        <ul>
            <li><strong>Operator Precedence within Embedded Expressions</strong>: Governed by the rules of the embedded language (e.g., JavaScript), not RCL's EBNF.</li>
            <li><strong>Ambiguity Resolution</strong>: Assumed to be handled by the chosen parsing technology.</li>
            <li><strong>Error Recovery</strong>: Parser implementation details are not defined in this specification.</li>
            <li><strong>Semantic Validation</strong>: Type checking, reference resolution, circular dependency detection, and schema constraint enforcement are handled by other language services.</li>
            <li><strong>Transformation of Shortcuts</strong>: The conversion of shortcuts to their full structures is a separate desugaring step.</li>
        </ul>
    </section>

    <section class="appendix">
        <h2>Error Classification (Syntax vs. Semantic)</h2>
        <p>This section outlines the distinction between syntax errors (violations of this EBNF) and semantic errors (violations of rules beyond pure syntax, often context-dependent or related to external schemas).</p>
        <section>
            <h3>Syntax Errors</h3>
            <p>Syntax errors occur when the input RCL document does not conform to the EBNF rules defined in this specification. The parser will typically be unable to construct a valid Abstract Syntax Tree (AST). Examples include:</p>
            <ul>
                <li><strong>Missing or Misplaced Keywords</strong>: e.g., `AgentName` instead of `'Agent' AgentName`.</li>
                <li><strong>Incorrect Token Types</strong>: e.g., Using a <a href="#NUMBER_def">NUMBER</a> where an <a href="#IDENTIFIER_def">IDENTIFIER</a> is expected for a flow name.</li>
                <li><strong>Malformed Terminals</strong>: e.g., An unclosed <a href="#STRING_def">STRING</a> literal like `"Hello world`.</li>
                <li><strong>Incorrect Sequence of Elements</strong>: e.g., Defining an <a>EnhancedWithClause</a> before the `'->'` in an <a>EnhancedFlowRule</a>.</li>
                <li><strong>Invalid Block Structure</strong>: e.g., Mismatched <a href="#INDENT_def">INDENT</a>/<a href="#DEDENT_def">DEDENT</a> pairs, or properties not correctly indented under their parent section keyword.</li>
                <li><strong>Lexical Errors</strong>: e.g., An <a href="#IDENTIFIER_def">IDENTIFIER</a> starting with a lowercase letter (violates the <a href="#IDENTIFIER_def">IDENTIFIER</a> terminal rule), an <a href="#ATOM_def">ATOM</a> without a leading colon.</li>
                <li><strong>Violation of Cardinality</strong>: e.g., Providing two `displayName` properties in an <a>AgentDefinition</a> where only one is allowed (`?` or no quantifier implies one).</li>
            </ul>
        </section>
        <section>
            <h3>Semantic Errors</h3>
            <p>Semantic errors occur when the RCL document is syntactically correct according to the EBNF, but violates other rules of the language or external constraints. These are typically caught by validators or during other language processing stages (like linking or code generation).</p>
            <ul>
                <li><strong>Undefined References</strong>: e.g., `ref NonExistentFlow` where `NonExistentFlow` is not defined anywhere.</li>
                <li><strong>Type Mismatches (Beyond Basic Syntax)</strong>: e.g., In `&lt;phone "not-a-number"&gt;`, the syntax `&lt;<a href="#TYPE_NAME_def">TYPE_NAME</a> <a href="#STRING_def">STRING</a>&gt;` is valid, but `"not-a-number"` is semantically incorrect for the `phone` type.</li>
                <li><strong>Schema Constraint Violations</strong>: 
                    <ul>
                        <li>Exceeding maximum string lengths (e.g., <a>SuggestedReply</a> text > 25 characters).</li>
                        <li>Exceeding array limits (e.g., more than 11 <a>Suggestion</a>s in an <a>AgentContentMessage</a>).</li>
                        <li>Invalid <a href="#ATOM_def">ATOM</a> values for a specific context (e.g., `messageTrafficType: :NOT_A_VALID_TYPE`).</li>
                        <li>Missing a schema-required field that RCL made syntactically optional (e.g., omitting `messageTrafficType` from both <a>AgentMessage</a> and <a>DefaultsSection</a> would be a semantic error upon generation if the API truly requires it).</li>
                    </ul>
                </li>
                <li><strong>Circular Dependencies</strong>: e.g., `flow A -> ref B; flow B -> ref A`.</li>
                <li><strong>Logical Errors in Expressions</strong>: e.g., `$js> let x = 1 / 0;` is syntactically valid JS but can lead to runtime issues or produce `Infinity`.</li>
                <li><strong>Contextual Rule Violations</strong>: e.g., A flow name that is a reserved section name like "Config" (if validation rules disallow this).</li>
                <li><strong>Use of Deprecated Features</strong>: If a feature is syntactically allowed but marked as deprecated by semantic validators.</li>
                <li><strong>Invalid <a href="#TYPE_NAME_def">TYPE_NAME</a> in <a>TypeConversion</a></strong>: e.g., `&lt;nonexistenttype "value"&gt;`.</li>
            </ul>
        </section>
    </section>

  </body>
</html>
